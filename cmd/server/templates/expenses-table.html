{{ define "expenses-table" }}
<div class="w-full">
    <!-- Desktop Table View -->
    <div class="hidden md:block overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        <i class="fas fa-calendar-day mr-1"></i>
                        {{t .Lang "expenses.date"}}
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        <i class="fas fa-tag mr-1"></i>
                        {{t .Lang "expenses.category"}}
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        <i class="fas fa-align-left mr-1"></i>
                        {{t .Lang "expenses.description"}}
                    </th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                        <i class="fas fa-dollar-sign mr-1"></i>
                        {{t .Lang "expenses.amount"}}
                    </th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                        <i class="fas fa-calculator mr-1"></i>
                        {{t .Lang "expenses.running_total"}}
                    </th>
                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                        <i class="fas fa-cog mr-1"></i>
                        {{t .Lang "expenses.actions"}}
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {{ $runningTotal := 0.0 }}
                {{ range . }}
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        {{ formatDate .Date }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-3 py-1 rounded-full text-sm font-semibold
                            {{ if eq .Category "Food" }}
                                bg-green-100 text-green-800
                            {{ else if eq .Category "Transportation" }}
                                bg-blue-100 text-blue-800
                            {{ else if eq .Category "Entertainment" }}
                                bg-purple-100 text-purple-800
                            {{ else if eq .Category "Shopping" }}
                                bg-pink-100 text-pink-800
                            {{ else if eq .Category "Bills" }}
                                bg-yellow-100 text-yellow-800
                            {{ else if eq .Category "Health" }}
                                bg-red-100 text-red-800
                            {{ else }}
                                bg-gray-100 text-gray-800
                            {{ end }}">
                            {{ if eq .Category "Food" }}ğŸ½ï¸
                            {{ else if eq .Category "Transportation" }}ğŸš—
                            {{ else if eq .Category "Entertainment" }}ğŸ®
                            {{ else if eq .Category "Shopping" }}ğŸ›ï¸
                            {{ else if eq .Category "Bills" }}ğŸ“„
                            {{ else if eq .Category "Health" }}ğŸ¥
                            {{ else }}ğŸ“¦
                            {{ end }}
                            {{ .Category }}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        {{ .Description }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-medium">
                        {{ formatMoney .Amount }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-medium">
                        {{ $runningTotal = add $runningTotal .Amount }}
                        {{ formatMoney $runningTotal }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <button 
                            class="p-2 rounded-full bg-red-100 text-red-600 hover:text-white hover:bg-red-600 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-500"
                            hx-delete="/expenses/delete?id={{ .ID }}&selected-month={{ formatDate .Date }}"
                            hx-target="#expenses-table"
                            hx-swap="innerHTML"
                            hx-confirm="{{t .Lang "expenses.delete_confirm"}}">
                            <i class="fas fa-trash-alt text-lg"></i>
                            <span class="sr-only">{{t .Lang "expenses.delete"}}</span>
                        </button>
                    </td>
                </tr>
                {{ end }}
            </tbody>
        </table>
    </div>

    <!-- Mobile Card View -->
    <div class="md:hidden space-y-4">
        {{ $runningTotal := 0.0 }}
        {{ range . }}
        <div class="bg-white rounded-xl shadow-md p-4 space-y-3 touch-manipulation">
            <div class="flex justify-between items-start">
                <span class="px-3 py-1 rounded-full text-sm font-semibold
                    {{ if eq .Category "Food" }}
                        bg-green-100 text-green-800
                    {{ else if eq .Category "Transportation" }}
                        bg-blue-100 text-blue-800
                    {{ else if eq .Category "Entertainment" }}
                        bg-purple-100 text-purple-800
                    {{ else if eq .Category "Shopping" }}
                        bg-pink-100 text-pink-800
                    {{ else if eq .Category "Bills" }}
                        bg-yellow-100 text-yellow-800
                    {{ else if eq .Category "Health" }}
                        bg-red-100 text-red-800
                    {{ else }}
                        bg-gray-100 text-gray-800
                    {{ end }}">
                    {{ if eq .Category "Food" }}ğŸ½ï¸
                    {{ else if eq .Category "Transportation" }}ğŸš—
                    {{ else if eq .Category "Entertainment" }}ğŸ®
                    {{ else if eq .Category "Shopping" }}ğŸ›ï¸
                    {{ else if eq .Category "Bills" }}ğŸ“„
                    {{ else if eq .Category "Health" }}ğŸ¥
                    {{ else }}ğŸ“¦
                    {{ end }}
                    {{ .Category }}
                </span>
                <button 
                    class="p-3 rounded-full bg-red-100 text-red-600 hover:text-white hover:bg-red-600 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 touch-manipulation"
                    hx-delete="/expenses/delete?id={{ .ID }}&selected-month={{ formatDate .Date }}"
                    hx-target="#expenses-table"
                    hx-swap="innerHTML"
                    hx-confirm="{{t .Lang "expenses.delete_confirm"}}">
                    <i class="fas fa-trash-alt text-lg"></i>
                    <span class="sr-only">{{t .Lang "expenses.delete"}}</span>
                </button>
            </div>
            <div class="text-lg font-medium text-gray-900">{{ .Description }}</div>
            <div class="flex justify-between items-center text-sm text-gray-500">
                <div class="flex items-center">
                    <i class="fas fa-calendar-day text-gray-400 mr-2"></i>
                    {{ formatDate .Date }}
                </div>
                <div class="font-semibold text-gray-900 text-lg">{{ formatMoney .Amount }}</div>
            </div>
            {{ $runningTotal = add $runningTotal .Amount }}
            <div class="text-xs text-right text-gray-500 flex items-center justify-end">
                <i class="fas fa-calculator text-gray-400 mr-2"></i>
                {{t .Lang "expenses.running_total"}}: {{ formatMoney $runningTotal }}
            </div>
        </div>
        {{ else }}
        <div class="bg-white rounded-xl shadow-md p-8 text-center">
            <div class="flex flex-col items-center justify-center space-y-4">
                <div class="w-16 h-16 flex items-center justify-center bg-gray-100 text-gray-400 rounded-full">
                    <i class="fas fa-receipt text-3xl"></i>
                </div>
                <p class="text-lg text-gray-500">{{t .Lang "expenses.no_expenses"}}</p>
                <p class="text-sm text-gray-400">{{t .Lang "expenses.add_first"}}</p>
                <button onclick="toggleAddExpenseForm()" 
                        class="mt-4 bg-blue-500 text-white px-6 py-3 rounded-xl text-sm font-medium hover:bg-blue-600 transition-colors duration-200 flex items-center">
                    <i class="fas fa-plus mr-2"></i>
                    {{t .Lang "expenses.add_button"}}
                </button>
            </div>
        </div>
        {{ end }}
    </div>
</div>

<script>
function deleteExpense(id) {
    const selectedMonth = document.getElementById('selected-month').value;
    htmx.ajax('DELETE', `/expenses/delete?id=${id}&selected-month=${selectedMonth}`, {
        target: '#expenses-table',
        swap: 'innerHTML',
        headers: {
            'HX-Trigger': 'updateSummary'
        }
    }).then(() => {
        const summaryUrl = `/summary?selected-month=${selectedMonth}`;
        htmx.ajax('GET', summaryUrl, '#summary-cards');
        
        // Trigger haptic feedback on successful delete
        if (window.navigator && window.navigator.vibrate) {
            window.navigator.vibrate(100);
        }
    });
}
</script>
{{ end }} 