<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Manager</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="/static/css/styles.css">
    <!-- Live Reload Script -->
    <script>
        document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] +
        ':35729/livereload.js?snipver=1"></' + 'script>')
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 flex items-center">
                <i class="fas fa-wallet text-blue-500 mr-3"></i>
                Expense Manager
            </h1>
            <div class="flex space-x-4">
                <a href="/reports" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors flex items-center">
                    <i class="fas fa-chart-line mr-2"></i>
                    View Reports
                </a>
                <a href="/admin" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors flex items-center">
                    <i class="fas fa-shield-alt mr-2"></i>
                    Admin
                </a>
            </div>
        </div>

        <!-- Summary Cards Section - Full Width -->
        <div class="w-full mb-8">
            <div id="summary-cards" 
                 hx-get="/summary"
                 hx-trigger="updateSummary from:body"
                 hx-target="#summary-cards"
                 hx-swap="innerHTML">
                {{ template "summary-cards" . }}
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Add Expense Form -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-plus-circle text-green-500 mr-2"></i>
                        Add New Expense
                    </h2>
                    <form hx-post="/expenses/add" 
                          hx-target="#expenses-table"
                          hx-swap="innerHTML"
                          class="space-y-4"
                          hx-on::after-request="updateMonthFromDate(this.querySelector('[name=date]').value)">
                        <input type="hidden" name="selected-month" id="form-selected-month">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="amount">
                                <i class="fas fa-dollar-sign mr-1"></i>
                                Amount
                            </label>
                            <input type="number" 
                                   step="0.01" 
                                   name="amount" 
                                   required
                                   class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="category">
                                <i class="fas fa-tag mr-1"></i>
                                Category
                            </label>
                            <select name="category" 
                                    required
                                    class="form-select mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                <option value="Food">üçΩÔ∏è Food</option>
                                <option value="Transportation">üöó Transportation</option>
                                <option value="Entertainment">üéÆ Entertainment</option>
                                <option value="Shopping">üõçÔ∏è Shopping</option>
                                <option value="Bills">üìÑ Bills</option>
                                <option value="Health">üè• Health</option>
                                <option value="Other">üì¶ Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="description">
                                <i class="fas fa-align-left mr-1"></i>
                                Description
                            </label>
                            <input type="text" 
                                   name="description" 
                                   required
                                   class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="date">
                                <i class="fas fa-calendar mr-1"></i>
                                Date
                            </label>
                            <input type="date" 
                                   name="date" 
                                   required
                                   class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                        </div>
                        <button type="submit" 
                                class="w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors duration-200 flex items-center justify-center">
                            <i class="fas fa-plus mr-2"></i>
                            Add Expense
                        </button>
                    </form>
                </div>
            </div>
            <!-- Expenses List -->
            <div class="lg:col-span-2">
                {{ template "month-nav" . }}
                <div class="bg-white rounded-lg shadow-md">
                    <div id="expenses-table">
                        {{ template "expenses-table" .Expenses }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    function updateMonthFromDate(dateStr) {
        if (!dateStr) return;
        
        // Extract YYYY-MM from the full date
        const monthStr = dateStr.substring(0, 7);
        
        // Update both the month picker and the form's hidden input
        document.getElementById('selected-month').value = monthStr;
        document.getElementById('form-selected-month').value = monthStr;
        
        // Trigger a change event on the month picker to refresh the expenses list
        document.getElementById('selected-month').dispatchEvent(new Event('change'));
    }
    </script>
</body>
</html> 